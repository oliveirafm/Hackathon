pragma solidity ^0.4.0;
contract InvoiceControl {
    address creator;
    uint createdDate;
    
    uint8 public decimalPlaces = 2; // stored ints are to be divided by 10 for correct value

    struct CompanyInfo {
        int companyId;
        string companyName;
        int vatNumber;
        string kvkNumber;
        string iban;
    }

    CompanyInfo public companyInfo;

    function InvoiceControl(int _companyId, 
                            string _companyName, 
                            int _vatNumber, 
                            string _kvkNumber, 
                            string _iban) {
        creator = msg.sender;
        createdDate = now;
        
        companyInfo.companyId = _companyId;
        companyInfo.companyName = _companyName;
        companyInfo.vatNumber = _vatNumber;
        companyInfo.kvkNumber = _kvkNumber;
        companyInfo.iban = _iban;   
    }

    modifier onlyCreator() {
        if (msg.sender != creator) throw;
        _;
    }
    
    struct PaymentDivision {
        uint serviceId;
        string serviceName;
        int value;
    }
    
    
    struct Invoice {
        uint invoiceId;
        string customerName;
        int customerVatNumber;
        int invoiceValue;
        int invoiceVatValue;
        uint issueDate;
        uint dueDate;
        uint createdDate;
        uint numPaymentDivisions;
        mapping (uint => PaymentDivision) paymentDivisions;
    }
     
    Invoice[] public invoices;
    
    function addInvoice(uint _invoiceId,
                        string _customerName,
                        int _customerVatNumber,
                        int _invoiceValue,
                        int _invoiceVatValue,
                        uint _issueDate,
                        uint _dueDate,
                        uint _createdDate) onlyCreator { 
        Invoice i = invoices[_invoiceId];
        i.invoiceId = _invoiceId;
        i.customerName = _customerName;
        i.customerVatNumber = _customerVatNumber;
        i.invoiceValue = _invoiceValue;
        i.invoiceVatValue = _invoiceVatValue;
        i.issueDate = _issueDate;
        i.dueDate = _dueDate;
        i.createdDate = now;
    }
    
    function addPaymentDivision(uint _invoiceId,
                                uint _serviceId,
                                string _serviceName,
                                int _value) onlyCreator { 
        Invoice i = invoices[_invoiceId];
        PaymentDivision pd = i.paymentDivisions[i.numPaymentDivisions++];
        pd.serviceId = _serviceId;
        pd.serviceName = _serviceName;
        pd.value = _value;
    }
    
    
    function numberOfInvoices() returns (uint retVal) {
        return invoices.length;
    }

}

ByteCode: 60606040526002600260006101000a81548160ff021916908360ff1602179055503461000057604051610ae0380380610ae0833981016040528080519060200190919080518201919060200180519060200190919080518201919060200180518201919050505b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555042600181905550846003600001819055508360036001019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061010757805160ff1916838001178555610135565b82800160010185558215610135579182015b82811115610134578251825591602001919060010190610119565b5b50905061015a91905b8082111561015657600081600090555060010161013e565b5090565b5050826003600201819055508160036003019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106101b557805160ff19168380011785556101e3565b828001600101855582156101e3579182015b828111156101e25782518255916020019190600101906101c7565b5b50905061020891905b808211156102045760008160009055506001016101ec565b5090565b50508060036004019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061025957805160ff1916838001178555610287565b82800160010185558215610287579182015b8281111561028657825182559160200191906001019061026b565b5b5090506102ac91905b808211156102a8576000816000905550600101610290565b5090565b50505b50505050505b61081c806102c46000396000f30060606040523615610076576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806336f281a91461007b5780634e6d140514610240578063b3c3dd471461032b578063c0fc823b1461039d578063cb0fbf3014610433578063e1725c9214610456575b610000565b346100005761008861047f565b604051808681526020018060200185815260200180602001806020018481038452888181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156101255780601f106100fa57610100808354040283529160200191610125565b820191906000526020600020905b81548152906001019060200180831161010857829003601f168201915b50508481038352868181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156101a85780601f1061017d576101008083540402835291602001916101a8565b820191906000526020600020905b81548152906001019060200180831161018b57829003601f168201915b505084810382528581815460018160011615610100020316600290048152602001915080546001816001161561010002031660029004801561022b5780601f106102005761010080835404028352916020019161022b565b820191906000526020600020905b81548152906001019060200180831161020e57829003601f168201915b50509850505050505050505060405180910390f35b346100005761025b60048080359060200190919050506104a0565b604051808a81526020018060200189815260200188815260200187815260200186815260200185815260200184815260200183815260200182810382528a8181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156103145780601f106102e957610100808354040283529160200191610314565b820191906000526020600020905b8154815290600101906020018083116102f757829003601f168201915b50509a505050505050505050505060405180910390f35b346100005761039b600480803590602001909190803590602001909190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080359060200190919050506104fa565b005b3461000057610431600480803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091908035906020019091905050610662565b005b34610000576104406107cf565b6040518082815260200191505060405180910390f35b34610000576104636107dd565b604051808260ff1660ff16815260200191505060405180910390f35b60038060000154908060010190806002015490806003019080600401905085565b60088181548110156100005790600052602060002090600a020160005b9150905080600001549080600101908060020154908060030154908060040154908060050154908060060154908060070154908060080154905089565b60006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561055a57610000565b60088681548110156100005790600052602060002090600a020160005b509150816009016000836008016000815480929190600101919050558152602001908152602001600020905084816000018190555083816001019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106105fa57805160ff1916838001178555610628565b82800160010185558215610628579182015b8281111561062757825182559160200191906001019061060c565b5b50905061064d91905b80821115610649576000816000905550600101610631565b5090565b50508281600201819055505b5b505050505050565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156106c057610000565b60088981548110156100005790600052602060002090600a020160005b50905088816000018190555087816001019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061073757805160ff1916838001178555610765565b82800160010185558215610765579182015b82811115610764578251825591602001919060010190610749565b5b50905061078a91905b8082111561078657600081600090555060010161076e565b5090565b50508681600201819055508581600301819055508481600401819055508381600501819055508281600601819055504281600701819055505b5b505050505050505050565b600060088054905090505b90565b600260009054906101000a900460ff16815600a165627a7a723058203b46bec87b0f4d7a24cd9615dd12cf7a2c12dc74e51c8c24a35bea3c9293f74c0029

ABI: [{"constant":true,"inputs":[],"name":"companyInfo","outputs":[{"name":"companyId","type":"int256"},{"name":"companyName","type":"string"},{"name":"vatNumber","type":"int256"},{"name":"kvkNumber","type":"string"},{"name":"iban","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"invoices","outputs":[{"name":"invoiceId","type":"uint256"},{"name":"customerName","type":"string"},{"name":"customerVatNumber","type":"int256"},{"name":"invoiceValue","type":"int256"},{"name":"invoiceVatValue","type":"int256"},{"name":"issueDate","type":"uint256"},{"name":"dueDate","type":"uint256"},{"name":"createdDate","type":"uint256"},{"name":"numPaymentDivisions","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_invoiceId","type":"uint256"},{"name":"_serviceId","type":"uint256"},{"name":"_serviceName","type":"string"},{"name":"_value","type":"int256"}],"name":"addPaymentDivision","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_invoiceId","type":"uint256"},{"name":"_customerName","type":"string"},{"name":"_customerVatNumber","type":"int256"},{"name":"_invoiceValue","type":"int256"},{"name":"_invoiceVatValue","type":"int256"},{"name":"_issueDate","type":"uint256"},{"name":"_dueDate","type":"uint256"},{"name":"_createdDate","type":"uint256"}],"name":"addInvoice","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"numberOfInvoices","outputs":[{"name":"retVal","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"decimalPlaces","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"inputs":[{"name":"_companyId","type":"int256"},{"name":"_companyName","type":"string"},{"name":"_vatNumber","type":"int256"},{"name":"_kvkNumber","type":"string"},{"name":"_iban","type":"string"}],"payable":false,"type":"constructor"}]
